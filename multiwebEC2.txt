AWS hosting multiple websites on a single EC2 instance

- Learning Outcomes

1. Provision secondary private IP address and Elastic IP address
	- In order to allow multiple websites or multiple web pages to run on one EC2 instance, we need elastic addresses or the private ip addresses

2. How to get secondary IP recognized by my OS
	- beccause wheen we launch an EC2 instance it is provided with a single public IP and a single private IP
	
3. Create 2 different web pages on Apache server

4. Associating those web pages with our different elastic IP
	- with those elastic IPs we will be making the webage run


	
ELASTIC IP ADDRESS DEFIINITION
	- static IP address that is associated with our EC2 instance
	
	
- when we stop our instance, the public ip of our instance gets lost

USES OF MULTIPLE IP ADDRESSES

- It can be useful to assign multiple IP addresses to an instance in the Virtual Private Cloud to do the following:
	- Host multiple websites on a single server by using multiple SSL (Secure Socket Layer) certificates
	
	- Operate network appliances such as firewalls or load balancers that have multiple IP addresses for each network interface.
	
	- Redirect internal traffic to a standby instance in case your instance fails, by reassiggning the secondary IP address to the standby instance
	
	



------------------------------------------------------------------------------------------







FIRST! What is AWS in simple terms

- AWS is a colletion of cloud services that interlock to make complex applications. Use Legos as an analogy

	- EC2 is just one lego piece in the whole Amazon Web Services

What is an EC2 instance? (Elastic Cloud Computing)
 - EC2 instancees are virtual computers hosted in AWS that allow for scalable computing capacity in the AWS cloud.
 
 
 FROM AWS MANAGEMENT CONSOLE THESE ARE THE SPECIFIC REQUIREMENTS FOR APACHE DEPLOYED ON EC2 INSTANCE:
	- Select EC2 -> instsances -> launch instances
	- Select Ubuntu (or Amazon Linux) AMI (Amazon Machine Image) 
		- AMI is a templatee that contains the software configs (OS, application server, and apps) to launch my instance
	- instance type is free tier in this case t2.micro
	- Create key pair 
		- Make sure keypair is in linux if you're using WSL

	- Firewall(security groups)
		- Allow SSH traffic from everywhere 
			-- This rule allows inbound SSH(Secure Shell) traffic to your instances by any IP addresses on the internet
			-- SSH typically used for secure remote access to servers
			-- By allowing SSH traffic from everywhere, any device or user with network access to your AWS instance will be able to establish an SSH connection to it
				- Secure Shell (SSH) traffic refers to network communication using the SSH protocol. 
				- SSH is a cryptographic network protocol that provides secure communication over an unsecured network
				- Widely used for secure remote access to systems and for secure file transfer
					SSH TRAFFIC EXAMPLES:
						- Logging into remote server or VM to perform administrative tasks
						- Transferrinng files securely between systems using tools like SCP (Secure Copy) or SFTP (SSH File Transfer Protocol)
						- Executing commands on a remote system using SSH commands or scripts

		- Allows HTTP traffic from internet
			-- This rule allows inbound HTTP(Hypertext Transfer Protocol) traffic to your instances from any IP address on the internet.
			-- HTTP is the protocol used for weving web bpagess and other web content. 
			-- By allowing HTTP traffic from the internet, your instances will be accessible to web users, allowing them to browse web content hosted on your AWS instances
				HTTP TRAFFIC EXAMPLES:
					- Requesting Web pages: WHen you type a URL iinto your web browswer's address bar or click on a link, your browser sends an HTTP request to the corresponding web server to retrieve the requested web pages
					- Submitting forms: When you fill out and submit a form on a web page, your browser sends an HTTP request to the server containing the form data, and the server responds with an HTTP response confirming the submission or provviding any necessary feedback
					- Loading resources: When a web page loads, the browseer sends multiple HTTP requests to the server to reetrieve all the resources needed to render the page, including HTML, CSS, Javascript, images and multimedia files
					- Downloading files: When you download a file form a website, your browser sennds an HTTP request to the server to retieve the file, and the serveer respons withh the file data, which your browser then downloads and saves to your computer 

	- Launch Instance button - there'll be a link that takes you back to main instance page and I can check the box of my instance and wait for instance state and status check to complete (2/2)
	- Press "Connect" button beacuse we're going to connect to instance using SSH
	
	- CONNECT TO INSTANCE PAGE
		- select "SSH client"
		- open ubuntu terminal if you're using WSL
		- navigate to directory containing the private key. In the steps given on the "connect to instance" page, the actual name of the key is listed
		- run the chmod "${anything}.pem" in my case : chmod 400 "multiWeb.pem"
			- chmod in Unix-like OS is used to change the permissions of the files and directories.
			- "400" is a numeric representation of the permissions
				- "4" = read permission
				- "2" = write permission
				- "1" = execute permission
			- The first digit (4) sets read permission for the owner of the file.
			- The next two digits (00) signify no permissions for the group and others
		- run : ssh -i "multiWeb.pem" ubuntu@ec2-13-59-0-191.us-east-2.compute.amazonaws.com
			- "ssh" : this is the command-line tool that's used to establish a secure shell connection
			- i "multiWeb.pem" : specifies the indentity (private key) to be used for authentication.
				- in this case, the file named "multiWeb.pem"
				- Private key authentication is often used to connect to EC2 instances securely instead of a password
			- ubuntu : the username used to log in to the EC2 instance.
			- ec2-13-59-0-191.us-east-2.compute.amazonaws.com : the public Domain Name System (DNS)

	- CHECK TO SEE IF CONNECTED
		- before running the command my terminal looked like : patrick@Patrick:~$
		- AFTER running the commands my terminal looks like : ubuntu@ip-172-31-14-203:~$
			- this terminal prompt indicates that I have successfully connected to an Amazon Elastic Cloud Computing instance using Secure Shell

	- TIME TO INSTALL APACHE WEB SERVER ON EC2 INSTANCE
		- run : sudo su this switches to root user which means unrestricted access to system files and configs
		- AFTER running sudo su : terminal looks like root@ip-172-31-14-203:/home/ubuntu#
			- root : theh username I'm logged in as. Unrestricted access to all commands and files on the system
			- ip-172-31-14-203 : this is the hostname of the EC2 instance you're connected to. It's showing the internal IP address of the instance
			- /home/ubuntu# : is the working directory, in this case, i'm in the home/ubuntu directory and the "#" denotes root level priviliges
		- since i'm running ubunutu i'd use the command : apt install -y apache2. If i were using Amazon Linux AMI i'd use : yum install -y httpd.x86-64
			- this is due to the different distros of linux, but both commands will use their respective package manager (software tool to automate installation processes) to install an HTTP server
		- systemctl start apache2.service
		- systemctl enable apache2.service
	
	- CHECK TO SEE APACHE2 DEFAULT PAGE
		- go back to instances page and click on the instance and copy public ipv4 address and paste into address bar of browser. 
		- should see the default apache2 page

	- ASSOCIATE MORE PRIVATE IPS WITH MY EC2 INSTANCE
		- Actions -> Networking -> Manage IP addresses
		- click on something like this : eth0: eni-0a24c3654f54cb7d6 - 172.31.0.0/20
		- Assign new IP address
		- click save and let it auto assign

		- cd .. all the way back and cd into etc/netplan
		- open 50-cloud-init.yaml file. Everything below is the commented out section of the file

		  # This file is generated from information provided by the datasource.  Changes
		  # to it will not persist across an instance reboot.  To disable cloud-init's
		  # network configuration capabilities, write a file
		  # /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
		  # network: {config: disabled}

		- configure 50-cloud-init.yaml file. below is what it looks like after configuration
			network:
			    ethernets:
			        eth0:
			            dhcp4: true
			            dhcp6: false
			            addresses: [172.31.14.203/20, 172.31.13.112/20]
			            match:
			                macaddress: 02:c7:32:ca:75:af
			            set-name: eth0
			    version: 2
					- the only change was the addresses where I manually put the two addresses from "manage IP addresses" from EC2 webpage in an array with the net mask included

		- At this point I've made my OS recognize my secondary IP

	- ALLOCATING MULTIPLE ELASTIC IPS WITH MY INSTANCE
		- What are elastic IPs
			- Elastic IPs are static (fixed) IPs designed for dynamic cloud computing environments (i.e Amazon Web Services)
		- Good use of elastic IPs
			- When you launch an AWS EC2 instance(a virtual server) its assigned a public IP address by default. HOWEVER, this IP address can change if you stop and restart the instance.
			- Elastic IPs solve this issue because elastic IPs remain associated with that instance AND you can move it from one instance to another easily.

		- First, go to the left side nav bar and go to NETWORK & SECURITY -> Elastic IPs -> Allocate Elastic IP button (top right) -> Allocate (bottom right)

		- Need 2 of these Elastic IPs because I'll be hosting 2 websites on this instance

		- NOTE: clear public ipv4 addresses just below search bar to see the 2 EIPs

		- NEXT: stay on page because we need to associate these EIPs with my EC2 instance
		
		- Highlight 1 IP address then go to actions dropdown on top right -> associate elastic IP

		- Keep resoruce type the same

		- Instance, choose the EC2 instance that you want to associate it with

		- choose one of the private IP addresses (I just ran "ip a" while connected to the instance through ssh to view the private ip addresses)

		- press "associate" button (bottom right)

		- highlight these EIP one by one to check that the private IP is associated. 





	


-----------------------------------------------------------------------------------------------






Taking a tangent to learn about Jenkins which is an open-source automation server
	
	- Widely used for implementing CI/CD pipelines (series of automated steps that changes go through from development to deployment)
		- CI/CD is a practice in software dev where code changes are frequently integrated into a shared repo. Automated tests and deployments are triggered upon these changes.
		NOTE: Jenkins helps in automating the:
			- building
			- testing
			- deployments
		of software applications, enabiling teams to deliver high-quality software more rapdily and reliably
	
- First install Jenkins on EC2 instance
	- refer to this website -- https://www.jenkins.io/doc/book/installing/linux/#debianubuntu

	- NOTE: install Java first since Jenkins is a Java based application and needs a Java Development Kit to be installed on the server where it's running  (just copy the commands)
	- then copy the commands for the weekly release for debian distro

	- the series of commands below were returned when I pasted them into linux terminal

	 openjdk version "17.0.10" 2024-01-16
	OpenJDK Runtime Environment (build 17.0.10+7-Ubuntu-122.04.1)
	OpenJDK 64-Bit Server VM (build 17.0.10+7-Ubuntu-122.04.1, mixed mode, sharing)
	Command 'openjdk' not found, but can be installed with:
	sudo snap install openjdk
	-bash: syntax error near unexpected token `('
	-bash: syntax error near unexpected token `(' 

	- was able to fix using "sudo snap install openjdk"
		- openjdk is open Java Development Kit

	- You can check the status of Jenkins by inputing the commands, "sudo systemctl status jenkins". the example below is what it looks like when Jenkins is running 

	● jenkins.service - Jenkins Continuous Integration Server
     Loaded: loaded (/lib/systemd/system/jenkins.service; enabled; vendor preset: enabled)
     Active: active (running) since Wed 2024-03-27 18:49:30 UTC; 2min 39s ago
   Main PID: 33857 (java)
      Tasks: 39 (limit: 1121)
     Memory: 280.4M
        CPU: 40.572s
     CGroup: /system.slice/jenkins.service
             └─33857 /usr/bin/java -Djava.awt.headless=true -jar /usr/share/java/jenkins.war --webroot=/var/cache/jenki>

Mar 27 18:48:59 ip-172-31-14-203 jenkins[33857]: d89e77182fa24fdb8efa0e71679309e4
Mar 27 18:48:59 ip-172-31-14-203 jenkins[33857]: This may also be found at: /var/lib/jenkins/secrets/initialAdminPasswo>
Mar 27 18:48:59 ip-172-31-14-203 jenkins[33857]: *************************************************************
Mar 27 18:48:59 ip-172-31-14-203 jenkins[33857]: *************************************************************
Mar 27 18:48:59 ip-172-31-14-203 jenkins[33857]: *************************************************************
Mar 27 18:49:30 ip-172-31-14-203 jenkins[33857]: 2024-03-27 18:49:30.395+0000 [id=31]        INFO        jenkins.InitRe>
Mar 27 18:49:30 ip-172-31-14-203 jenkins[33857]: 2024-03-27 18:49:30.434+0000 [id=24]        INFO        hudson.lifecyc>
Mar 27 18:49:30 ip-172-31-14-203 systemd[1]: Started Jenkins Continuous Integration Server.
Mar 27 18:49:30 ip-172-31-14-203 jenkins[33857]: 2024-03-27 18:49:30.593+0000 [id=47]        INFO        h.m.DownloadSe>
Mar 27 18:49:30 ip-172-31-14-203 jenkins[33857]: 2024-03-27 18:49:30.594+0000 [id=47]        INFO        hudson.util.Re>


	- Go back to EC2 instance and select the correct instance,
	- Click on "Security" tab 
	- Click on the instance link itself (will have launch-wizard) at the end of it
	- Will take you to a new page 
	- Edit Inbound rules
		- Type: All TCP (this allows all Transmission Control Protocol from) Source: Anywhere ipv4

	- Reset jenkins server and check status again
		- "sudo systemctl restart jenkins"
		- "sudo systemctl status jenkins"

	- Copy elastic ip and tag ":8080" at the end and you should see the jenkins sign in page
		- :8080 -- the specified port that Jenkins was configured to run on

	- run the command /var/lib/jenkins
	- switch to super user (sudo su) for elevated priviliges and cd into secrets
	- run "nano initialAdminPassword" d89e77182fa24fdb8efa0e71679309e4

	IMPORTANT:  Username - pat 
				Password - Pat_4761
				Full Name - Patrick Abrena
				E-mail Address - patrickabrena@hotmail.com

	- Click next and save and start using Jenkins

	- Go back to Linux terminal and sudo apt install git -y 

	- cd into /etc
	- nano sudoers and then modify the file to look like the block displayed below

		- # Allow members of group sudo to execute any command
			%sudo   ALL=(ALL:ALL) ALL
			jenkins ALL=(ALL:ALL) NOPASSWD :ALL

			


----------------------------------------------------------------------------------------------





- Now, need to configure jenkins so that it has write permissions to the /var/www/html directory

	- run the command "stat -c "%a %G" /var/www/html" while ssh connected to instance
	- should return "755 root"
		- permissions set to 755 means the owner (root in this case) has read,write, and execute permissions but other groups have read and execute but not write permissions
		
	- need to grant the "www-data" group write permissions to "var/www/html"
		sudo chown -R root:www-data /var/www/html
		sudo chmod -R 775 /var/www/html
			- first command "chown" changes ownership of the dierectory and its contents to "root:www-data"
			- second command "chmod" sets the permissions to 775 which grants read, write and execute permissions to the owner (root), read and execute permissions to the group www-data and read and execute permissions to others.
			
	- check if ownership of var/www/html is no jenkins with the command "ls -ld /var/www/html"

	- if "drwxrwxr-x 2 root www-data 4096 Mar 31 16:20 /var/www/html" returns from the command above then you need to change ownership from root to jenkins with "sudo chown -R jenkins:www-data /var/www/html"

	- check if ownership changed with "ls -ld /var/www/html" again

	- should return "drwxrwxr-x 2 jenkins www-data 4096 Mar 31 16:20 /var/www/html"

CONFIGURING JENKINS CREDENTIALS FOR GITHUB USING SSH PRIVATE Key

- sign into Jenkins because we're going to...
	1. Check/Install Necessary Plugins
	2. Configure Jenkins Credentials for github
	3. Set Up a Jenkins Pipeline job\
	4. Configure Webhooks for Automatic Triggering
	5. Verify Configuration

Step 1: Install Necessary Plugins

    GitHub Plugin: Ensure the GitHub plugin is installed in Jenkins for GitHub integration.

        - Go to Manage Jenkins > Manage Plugins.
        - Check under Installed to see if the GitHub plugin is there. If not, go to - Available, search for the GitHub plugin, and install it.

    Pipeline Plugin: Confirm that the Pipeline plugin is installed using the same method, as it's essential for defining and running your Jenkins pipelines.

Step 2: Configure Jenkins Credentials for GitHub

You'll need appropriate credentials set up in Jenkins to access your GitHub repository. This could be a personal access token (recommended), an SSH key, or a username/password (not recommended).

    Go to Manage Jenkins > Manage Credentials > (global) > Add Credentials.
    Choose "Secret text" for a personal access token or "SSH Username with private key" if you're using SSH.
    Input your credentials:

        - For a personal access token, enter the token in the "Secret" field.
        - For SSH, enter the username and private key.

    Give it an ID and description so you can easily identify it later, then click OK.

Step 3: Set Up a Jenkins Pipeline Job

    In Jenkins, choose New Item.
    Enter a name for your pipeline, select Pipeline, and then click OK.
    In the pipeline configuration, scroll down to the Pipeline section.

        Definition: Select Pipeline script from SCM.
        SCM: Choose Git.
        Repository URL: Enter your GitHub repository URL.
        Credentials: Select the credentials you created for GitHub access.
        Branch Specifier (blank for 'any'): Specify the branch you want to build from, e.g., */main.

Step 4: Configure Webhooks for Automatic Triggering

To trigger Jenkins builds automatically on GitHub repository changes, you can use GitHub webhooks.

    In GitHub Repository Settings:
        Go to your repository on GitHub, click on Settings > Webhooks > Add webhook.
        Payload URL: Enter http://<JENKINS_URL>/github-webhook/, replacing <JENKINS_URL> with your Jenkins instance's URL.
        Content type: Select application/json.
        Which events would you like to trigger this webhook?: Choose Just the push event or Send me everything depending on your needs.
        Click Add webhook.

    In Jenkins:
        Ensure that the GitHub plugin is configured to manage hooks (Jenkins will automatically manage hooks for jobs that use GitHub repositories).

Step 5: Verify Configuration

    Push a change to your GitHub repository or manually trigger the webhook to test the integration.
    Check in Jenkins to see if the pipeline job runs automatically upon the GitHub event.

This setup establishes a basic CI/CD pipeline that reacts to changes in your GitHub repository, executing your Jenkins pipeline automatically. Depending on your specific requirements, you might adjust webhook settings, branch specifications, or pipeline scripts.





-------------------------------------------------------------------------------



	- For step 2: configure jenkins credentials for github...

		- Sign in -> Manage Jenkins (left nav bar) -> Credentials (Configure credentials) -> 
		- Under domain, you should see "(global)"
		- click on it, then "Add Credentials"
		- Switch kind to SSH Username with private key
		- run command "ssh-keygen" while ssh connected to instance that has the server on it
		- running that command will give something like this on return
			Generating public/private rsa key pair.
			Enter file in which to save the key (/home/ubuntu/.ssh/id_rsa):
			Enter passphrase (empty for no passphrase):
			Enter same passphrase again:
			Your identification has been saved in /home/ubuntu/.ssh/id_rsa
			Your public key has been saved in /home/ubuntu/.ssh/id_rsa.pub
			The key fingerprint is:
			SHA256:TYyMmb31alDKEERj4hF4SVcY51/lHM4+vbuGg0vCgkE ubuntu@ip-172-31-14-203
			The key's randomart image is:

		- Once generates, you'll have a private key (eg. "id_rsa") and a public key (eg. "is_rsa.pub")

			Adding the SSH Key to Github

			- Open your public Key file (/home/ubuntu/.ssh/id_rsa.pub), copy its contents

			- In Github, navigate to Settings -> SSH and GPG keys -> New SSH Key
				- GPG (GNU Privacy Guard) note: GNU is "GNU's Not Unix" which is a Unix-like open-source operating system
				- GPG key is a tool used for encrypting and signing data and comms.
				- used to ensure confidentiality and integrity of data, verify the data of the sender and prevent tampering or unauth access 

			- Paste your public key, give it a title for identification, and click "Add SSH Key"

			- While ssh connected run ssh-keygen -lf /home/ubuntu/.ssh/id_rsa.pub
				- "-l" : tells ssh-keygen to show the fingerprint of the key.
					- fingerprint is a hash of the public key and is used to uniquely identify the key.
					- Useful for quickly verifying whether two keys are the same, without comparing the full key contents.

				- "-f" : specifies the filename of the key whose fingerprint is to be displayed.

				- this will return something like "3072 SHA256:TYyMmb31alDKEERj4hF4SVcY51/lHM4+vbuGg0vCgkE ubuntu@ip-172-31-14-203 (RSA)" which I can check and verify on github under settings -> SSH and GPG keys
			
			- run the command "ssh -T git@github.com"

				The authenticity of host 'github.com (140.82.113.3)' can't be established.
				ED25519 key fingerprint is SHA256:+DiY3wvvV6TuJJhbpZisF/zLDA0zPMSvHdkr4UvCOqU.
				This key is not known by any other names
				Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
				Warning: Permanently added 'github.com' (ED25519) to the list of known hosts.
				Enter passphrase for key '/home/ubuntu/.ssh/id_rsa':
				Hi patrickabrena! You've successfully authenticated, but GitHub does not provide shell access.
			
			- Check GPT "CHeck SSh Key Match" to see detailed explanation on verifying public key with jenkins


		NOTE: There might be an issue later on with github integration with jenkins  so be aware

		NOTE: "multiweb" is the passphrase for this instance




----------------------------------------------------------------------------------





	- For step 3, Setting up a Jenkins Pipeline Job

		- create 2 pipeline jobs, one for each webpage (hack and vic) and configure with webhooks to automatically pull from remote github repo to /var/www/html on our instance

		- first, we need to...
			- create new pipeline (check GPT CI/CD)
			- give it a description if you want
			- under Pipeline Definition, select Pipeline script form SCM
			- SCM: choose Git
			- Repository URL: copy the HTTP url from github
			- Credentials: select the one I configured and added to jenkins through ssh key-gen 

	- For step 4, Configure Webhooks for Automatic Triggering 
		 follow the first step by going to the repo > webhooks > Add webhook
		 copy address that jenkins is configured to in this case it's "http://18.191.88.173:8080" then add /github-webhook at the end

		 - content type: json
		 - "send me everything"
		 - Add web hook

		 - Need to verify it now...
		 	- go to the branch and add and commit a new test.txt file 
			- refresh jenkins it should have a build error at this point saying...
				"Started by GitHub push by patrickabrena
					ERROR: Unable to find Jenkinsfile from git https://github.com/patrickabrena/hack-page.git
					Finished: FAILURE"

			- I need to create a Jenkins file now that defines the entire pipline for a Jenkins Job. Written in Groovy DSL (Domain Specific Language)





---------------------------------------------------------------------------------------------



Taking another tangent to learn Groovy DSL for writing jenkins pipeline scripts

- need to create a jenkins file in the repo that has the webhook so that jenkins can read the pipeline script for instructions

- below is delcarative syntax

pipeline { //pipeline must be top level

	agent any // "agent" where to execute or run on any available jenkins agent

	stages { // "stages" - where the "work" happens

		stage("build") {

			steps
		}
	}
}

- example of stages below

stage("build") {

			steps
		}

stage("test") {

			steps
		}

stage("deploy") {

			steps
		}

node {
	// groovy script
	// this opening node with curly braces is the same as pipeline { agent any {}} 
}

- jenkins file can be written as a scripted or declarative pipeline

- onn jenkins UI, go configure the pipeline script path to .jenkins

- in the remote repo you used for the URL for pipeline script from SCM, add a .jenkins file and test it with...

pipeline {
    agent any
    stages {
        stage("Build") {
            steps {
             sh 'echo "Hello World"'
           }
        }
    }
}

- commit changes and then build and it should work. if not, check the console output to determine the error

- (04/30/2024) look at GPT "Get Host Key GitHub" to see how to get ssh key using cat then copy and paste into jenkins manually host key verification. 

- If .jenkins is being read as a javascript file then switch it to .jenkinsfile and remmemeber to switch scriipt path to .jenkinsfile in the configure sectiion of thee pipeline

- (05/01/2024) Current iteration of groovy script in hack-page works!

- (05/08/2024) had to create a new index.html to replace the one I deleted. also had to redo the permissiions to allow jenkins access to write over var/www/html

- (05/09/2024) trying to move private and public key for my instance to /root/.ssh to solve permission denied error for git cloning 

	- look at "Move SSH Keys to root's .ssh directory" for the steps I took after following 'Solution 2: Use sudo git clone' fix from article https://mhagemann.medium.com/how-to-fix-ssh-permission-denied-with-git-clone-f669b65f90ac

	now I'm getting.....

	+ sudo git clone git@github.com:patrickabrena/hack-page.git /var/www/html/hack-page
	fatal: destination path '/var/www/html/hack-page' already exists and is not an empty 	directory.
		
	The blurb below are commmands to do the sudo git clone but now thee file path is http://18.191.88.173/hack-page/hack-page/ so I need to fix that. 

	"ubuntu@ip-172-31-14-203:/$ cd var/www/html/
	ubuntu@ip-172-31-14-203:/var/www/html$ ls
	hack-page  index.html
	ubuntu@ip-172-31-14-203:/var/www/html$ cd hack-page/
	ubuntu@ip-172-31-14-203:/var/www/html/hack-page$ git status
	fatal: not a git repository (or any of the parent directories): .git
	ubuntu@ip-172-31-14-203:/var/www/html/hack-page$ git init
	/var/www/html/hack-page/.git: Permission denied
	ubuntu@ip-172-31-14-203:/var/www/html/hack-page$ sudo git init
	hint: Using 'master' as the name for the initial branch. This default branch name
	hint: is subject to change. To configure the initial branch name to use in all
	hint: of your new repositories, which will suppress this warning, call:
	hint:
	hint:   git config --global init.defaultBranch <name>
	hint:
	hint: Names commonly chosen instead of 'master' are 'main', 'trunk' and
	hint: 'development'. The just-created branch can be renamed via this command:
	hint:
	hint:   git branch -m <name>
	Initialized empty Git repository in /var/www/html/hack-page/.git/
	ubuntu@ip-172-31-14-203:/var/www/html/hack-page$ sudo git clone git@github.com:patrickabrena/hack-page.git
	Cloning into 'hack-page'...
	Enter passphrase for key '/root/.ssh/id_rsa':
	remote: Enumerating objects: 99, done.
	remote: Counting objects: 100% (99/99), done.
	remote: Compressing objects: 100% (70/70), done.
	remote: Total 99 (delta 53), reused 68 (delta 27), pack-reused 0
	Receiving objects: 100% (99/99), 12.83 KiB | 1010.00 KiB/s, done.
	Resolving deltas: 100% (53/53), done.
	ubuntu@ip-172-31-14-203:/var/www/html/hack-page$" 
		

- (05/10/2024) I cd into var/www/html on my ubuntu instance and then ran sudo rm -r hack-page
	then I sudo git init while in /var/www/html
	next I did sudo git clone git@github.com:patrickabrena/hack-page.git, "multiweb" is passpahrasee for key '/root/.ssh/id_rsa'
	http://18.191.88.173/hack-page/ now shows my index.html of my hacker-page!
	- now trying to just change groovy declarative script to be a simple git pull origin main to see if it successfully builds and pulls the updated code from remote github repo into mmy var/www/html/hack-page

- (05/11/2024) Going to follow along with Java Home Cloud's up until I can successfully create a CI/CD pipeline. Current build #61 reflects git checkout lessons even though it's redundant

- (05/13/2024) Taking a tangent to learn about Maven, aa build automation tool that helps keep consistent builds by 
	- automatically updating dependencies needed
	- compiling source code, runnig tests and packages theh code in JAR or WAR files
	- using pom.xml file to define project structure, dependecies, plugins and goals

	- Check GPTs suggestion 'Maveen integration with Jenkins' 
		-  latest query regarding the how to install maven on my ubuntu 20.04 EC2 instance 

- (05/14/2024) Having difficulty installing maven in opt directory
	- terminal reesponsee

		Setting up libcommons-parent-java (43-1) ...
Setting up libsisu-inject-java (0.3.4-2) ...
Setting up libsisu-plexus-java (0.3.4-3) ...
Setting up libmaven-resolver-java (1.4.2-3build1) ...
Setting up libguava-java (29.0-6) ...
Setting up libcommons-lang3-java (3.11-1) ...
Setting up libjansi-native-java (1.8-1) ...
Setting up libwagon-file-java (3.3.4-1) ...
Setting up libcommons-io-java (2.11.0-2) ...
Setting up libguice-java (4.2.3-2) ...
Setting up libjansi-java (1.18-1) ...
Setting up libmaven-shared-utils-java (3.3.0-1ubuntu0.22.04.1) ...
Setting up libmaven3-core-java (3.6.3-5) ...
Setting up maven (3.6.3-5) ...
update-alternatives: using /usr/share/maven/bin/mvn to provide /usr/bin/mvn (mvn) in auto mode
Scanning processes...
Scanning linux images...

Running kernel seems to be up-to-date.

No services need to be restarted.

No containers need to be restarted.

No user sessions are running outdated binaries.

No VM guests are running outdated hypervisor (qemu) binaries on
 this host.
ubuntu@ip-172-31-14-203:~$ mvn -version
Apache Maven 3.6.3
Maven home: /usr/share/maven
Java version: 17.0.10, vendor: Private Build, runtime: /usr/lib/jvm/java-17-openjdk-amd64
Default locale: en, platform encoding: UTF-8
OS name: "linux", version: "6.5.0-1018-aws", arch: "amd64", family: "unix"
ubuntu@ip-172-31-14-203:~$ wget https://downloads.apache.org/maven/maven-3/3.8.6/binaries/apache-maven-3.8.6-bin.tar.gz
--2024-05-14 17:53:49--  https://downloads.apache.org/maven/maven-3/3.8.6/binaries/apache-maven-3.8.6-bin.tar.gz
Resolving downloads.apache.org (downloads.apache.org)... 88.99.208.237, 135.181.214.104, 2a01:4f9:3a:2c57::2, ...
Connecting to downloads.apache.org (downloads.apache.org)|88.99.208.237|:443... connected.
HTTP request sent, awaiting response... 404 Not Found
2024-05-14 17:53:49 ERROR 404: Not Found.

- (05/15/2024) Yesterday I ran 'sudo apt install maven' and the issues was that the wget command that GPT sugggested was a different version of maven installed diffeerently?? So now I'm using newest conversation suggestion in GPT to just move the exisiting maven located in usr/share/maven into /opt directory.

- (05/16/2024) Following that latest suggestion throws error .....
	ubuntu@ip-172-31-14-203:~$ mvn -version
	Error: Could not find or load main class org.codehaus.plexus.classworlds.launcher.Launcher
	Caused by: java.lang.ClassNotFoundException: org.codehaus.plexus.classworlds.launcher.Launcher

	-- now trying to look at https://maven.apache.org/install.html and reading through directions for installing apache maven

- (05/17/2024) ran the commmand "sudo apt install openjdk-17-jdk-headless" now when I try 	javac -version I'm returned with .....
	ubuntu@ip-172-31-14-203:~$ javac -version
	javac 17.0.10

	- I need to have the compiler installed for maven

	- next, I ran the " wget https://downloads.apache.org/maven/maven-3/3.9.6/binaries/apache-maven-3.9.6-bin.tar.gz" command and wasa returned with ....


	 
	 --2024-05-17 17:04:33--  https://downloads.apache.org/maven/maven-3/3.9.6/binaries/apache-maven-3.9.6-bin.tar.gz
	Resolving downloads.apache.org (downloads.apache.org)... 88.99.208.237, 135.181.214.104, 	2a01:4f9:3a:2c57::2, ...
	Connecting to downloads.apache.org (downloads.apache.org)|88.99.208.237|:443... connected.
	HTTP request sent, awaiting response... 200 OK
	Length: 9410508 (9.0M) [application/x-gzip]
	Saving to: ‘apache-maven-3.9.6-bin.tar.gz’

	apache-maven-3.9.6-bin.tar.gz 100%[=================================================>]   8.	97M  6.79MB/s    in 1.3s

	2024-05-17 17:04:34 (6.79 MB/s) - ‘apache-maven-3.9.6-bin.tar.gz’ saved [9410508/9410508]

	- look at new conversation "File Extraction Issue Troubleshooting" and follow the directions for running tar commmand again

	- ran the "tar xzvf apache-maven-3.9.6-bin.tar.gz" command

	- then I ran "chmod 644 apache-maven-3.9.6-bin.tar.gz "

	- look back at the "Maven Integration with Jenkins" converesation for extracting tarball directly into /opt directoy


	- the blurb below is a copy of the terminal state with commands I ran and the returned responses

	ubuntu@ip-172-31-14-203:~$ rm -rf apache-maven-3.9.6
	ubuntu@ip-172-31-14-203:~$ sudo tar xf apache-maven-3.9.6-bin.tar.gz -C /opt
	ubuntu@ip-172-31-14-203:~$ sudo ln -s /opt/apache-maven-3.9.6/ /opt/maven
	ubuntu@ip-172-31-14-203:~$ sudo nano /etc/profile.d/maven.sh
	ubuntu@ip-172-31-14-203:~$ ls
	apache-maven-3.9.6-bin.tar.gz  snap
	ubuntu@ip-172-31-14-203:~$ cd ..
	ubuntu@ip-172-31-14-203:/home$ ls
	ubuntu
	ubuntu@ip-172-31-14-203:/home$ cd ..
	ubuntu@ip-172-31-14-203:/$ ls
	bin   dev  home  lib32  libx32      media  opt   root  sbin  srv  tmp  var
	boot  etc  lib   lib64  lost+found  mnt    proc  run   snap  sys  usr
	ubuntu@ip-172-31-14-203:/$ cd opt/
	ubuntu@ip-172-31-14-203:/opt$ ls
	apache-maven-3.9.6  maven
	ubuntu@ip-172-31-14-203:/opt$ cd ..
	ubuntu@ip-172-31-14-203:/$ ls
	bin   dev  home  lib32  libx32      media  opt   root  sbin  srv  tmp  var
	boot  etc  lib   lib64  lost+found  mnt    proc  run   snap  sys  usr
	ubuntu@ip-172-31-14-203:/$ sudo nano /etc/profile.d/maven.sh
	ubuntu@ip-172-31-14-203:/$ source /etc/profile.d/maven.sh
	ubuntu@ip-172-31-14-203:/$ mvn -version
	Apache Maven 3.9.6 (bc0240f3c744dd6b6ec2920b3cd08dcc295161ae)
	Maven home: /opt/maven
	Java version: 17.0.10, vendor: Private Build, runtime: /usr/lib/jvm/java-17-openjdk-amd64
	Default locale: en, platform encoding: UTF-8
	OS name: "linux", version: "6.5.0-1020-aws", arch: "amd64", family: "unix"
	ubuntu@ip-172-31-14-203:/$

	- go back to java homme cloud's video after thge git checkout videos on using maven for build autmation with jenkins


- (05/18/2024) Following Java Home Cloud 03 Jenkins Declarative Pipeline | Jenkins Maven Build.....
	 
	 this is my terminal copy using almost the same commands he did.....

	 ubuntu@ip-172-31-14-203:~$ ls /opt/maven/bin/
	m2.conf  mvn  mvn.cmd  mvnDebug  mvnDebug.cmd  mvnyjp
	ubuntu@ip-172-31-14-203:~$ mvn
	[INFO] Scanning for projects...
	[INFO] ------------------------------------------------------------------------
	[INFO] BUILD FAILURE
	[INFO] ------------------------------------------------------------------------
	[INFO] Total time:  0.202 s
	[INFO] Finished at: 2024-05-18T20:58:33Z
	[INFO] ------------------------------------------------------------------------
	[ERROR] No goals have been specified for this build. You must specify a valid lifecycle phase or a goal in the format <plugin-prefix>:<goal> or <plugin-group-id>:<plugin-artifact-id>[:<plugin-version>]:<goal>. Available lifecycle phases are: pre-clean, clean, post-clean, validate, initialize, generate-sources, process-sources, generate-resources, process-resources, compile, process-classes, generate-test-sources, process-test-sources, generate-test-resources, process-test-resources, test-compile, process-test-classes, test, prepare-package, package, pre-integration-test, integration-test, post-integration-test, verify, install, deploy, pre-site, site, post-site, site-deploy. -> [Help 1]
	[ERROR]
	[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.
	[ERROR] Re-run Maven using the -X switch to enable full debug logging.
	[ERROR]
	[ERROR] For more information about the errors and possible solutions, please read the following articles:
	[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/NoGoalSpecifiedException
	ubuntu@ip-172-31-14-203:~$

	-- now his returned response to "mvn" command is mvn: command not found where asa mine throws build error (possible bug)

	-- my console error from this build is ....

	[Pipeline] stage
	[Pipeline] { (Maven Build)
	[Pipeline] sh
	+ mvn clean package
	[INFO] Scanning for projects...
	[INFO] ------------------------------------------------------------------------
	[INFO] BUILD FAILURE
	[INFO] ------------------------------------------------------------------------
	[INFO] Total time:  0.292 s
	[INFO] Finished at: 2024-05-18T21:15:02Z
	[INFO] ------------------------------------------------------------------------
	[ERROR] The goal you specified requires a project to execute but there is no POM in this directory (/var/lib/jenkins/workspace/hacker-job). Please verify you invoked Maven from the correct directory. -> [Help 1]
	[ERROR] 
	[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.
	[ERROR] Re-run Maven using the -X switch to enable full debug logging.
	[ERROR] 
	[ERROR] For more information about the errors and possible solutions, please read the following articles:
	[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MissingProjectException
	[Pipeline] }
	[Pipeline] // stage
	[Pipeline] }
	[Pipeline] // withEnv
	[Pipeline] }
	[Pipeline] // withEnv
	[Pipeline] }
	[Pipeline] // node
	[Pipeline] End of Pipeline
	ERROR: script returned exit code 1
	Finished: FAILURE


	 THINGS TO TRY TOMORROW

	 watching video 4 "Simple CI/CD usiing Jenkins Declarative Pipeline" all the way through first then try the steps using my apache web server before trying tom cat. Possible solution at 5:37 time stamp up unttil neear the eend at 16;49

 - (05/22/2024) Highlevel overview notes on Simple CI/CD

	- 1. Launch Instance
			- security group should be configiured to allow all traffic (Security groups are firewalls in Amazon) 
			- he has tomcat downloaded on his instance I have apache
				-- apache2 is a general purpose webserver
				-- tomcat specifically designed to serve Java applications

		- left off at 1:27 in the video 

-(05/31/2024) looking at this video to troubleshoot common problem with instance reliability checks failed. 

	- Auto solution is to create a new alarm with....
		- alarm notification off
		- alarm action set to reboot
		- type of data to sample : status check failed (instance)
		- period : 1 min
	- it worked this time with the auto solution with reboot on alarm now but here's the link for next time
	- https://www.youtube.com/watch?v=G6Hz_KmbizM 

	WORKING IN THE .JENKINSFILE NOW!!!

	- look at build #64 to see fatal ambigious argument
	- revist this thread to read and figure out what's wrong 
	
		https://www.reddit.com/r/git/comments/mv6u75/what_does_fatal_ambiguous_argument_argument_name/

- (06.01.2024) watch this video on terminnal vs bash vs command line prompt 
		- https://www.youtube.com/watch?v=hMSByvFHOro 

- (06.02.2024) scouting out future projects after this one
	- Real Time DevOps Project | Use Terraform Jenkins AWS to deploy REST API
	- https://www.youtube.com/watch?v=otQqd7GRVK0 

- (06.06.2024) Possible reasons for fatal ambigious error...
	- the var/www/html repository on the instance that I want to pull the code into is not actually a git repo so maybe that's why I'm getting the errors in my my jenkins job console output

-(06.07.2024) When I ran sudo su and then var/www/html and then git init i reinitialized the repo so that means it was already git init from before. 

	- I've modified the .jenkinsfile so that there is no git reset command and I've also wrapped it in an sshagent block. 
	- the error code I'm getting from the jenkins console output is Error loading key "/var/lib/jenkins/workspace/hacker-job@tmp/private_key_13757191683239591515.key": error in libcrypto
	- when I do sudo su on my instance and try that file path it doesn't exist. I do have /var/lib/jenkins/workspace/hacker-job@tmp/secretFiles but there is no private_key.key
		- to resolve this i should use Jenkins Credential Bindings (check GPT "SSH Agent Environment Variables")

- (06.10.2024) 
	- trying something else instead of Jenkins credential Bindings
	- going to try to make Jenkins use the SSH key  located at /root/.ssh/id_rsa
	- Look back at GPT's SSH Agent Environment Variable  suggestion on handing jenkins job using id_rsa

	- suggestion and code from latest query in SSH Agent Environment Variable failed
	- try looking at forums for error loading key libcrypto

- (06.29.2024) 
	- Look at bookmark "How to connect to remote ssh agents"
	- thinking of moving the id_rsa.pub and id_rsa located in root directory, into (FN + Left Shift + Esc) ~/.ssh then following the steps in the blog post so taht I can remove the stage('Use SSH Key'). hoping to at least fix the error loading libcrypto 








